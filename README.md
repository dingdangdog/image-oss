# image-oss
image-oss

## ç®€ä»‹

image-ossåˆè¡·æ˜¯æ­å»ºä¸€ä¸ª ä¸ªäººå›¾åºŠæœåŠ¡ã€‚æ¼”ç¤ºç«™ï¼š[http://image-oss-demo.oldmoon.top/](http://image-oss-demo.oldmoon.top/)

> äº’è”ç½‘å„ç§å›¾åºŠçœ‹çš„çœ¼èŠ±ç¼­ä¹±ï¼Œç”¨èµ·æ¥è¿˜éœ€è¦é…ç½®å„ç§ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘æƒ³æ­å»ºä¸€ä¸ªè‡ªå·±çš„å›¾åºŠæœåŠ¡ï¼Œè¿™æ ·ç”¨èµ·æ¥æ›´åŠ é¡ºæ‰‹ã€‚

## å¿«é€Ÿå¼€å§‹

### Docker-Compose

- docker-compose.ymlç¤ºä¾‹

```yaml
version: "3"

services:
  image-oss:
    image: dingdangdog/image-oss:latest
    restart: always
    environment:
      TZ: "Asia/Shanghai"
    volumes:
      - ${PWD}/images:/data/image-oss/images
      - ${PWD}/application.yml:/usr/image-oss/jar/application.yml
    ports:
      - 11080:80
```

1. å»ºè®®åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç‹¬ç«‹çš„æ–‡ä»¶å¤¹ï¼Œå°†é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„`docker-compose.yml`å’Œ`application.yml`æ‹·è´åˆ°æœåŠ¡å™¨çš„æ–‡ä»¶å¤¹ä¸‹ã€‚

2. ä¿®æ”¹`application.yml`ä¸­çš„éƒ¨åˆ†é…ç½®

   - **å¿…é¡»ä¿®æ”¹çš„é…ç½®é¡¹**ï¼Œå°†å…¶ä¸­`http://localhost:80`ä¿®æ”¹ä¸ºä½ è‡ªå·±å›¾åºŠæœåŠ¡çš„åœ°å€ï¼Œæ¯”å¦‚æ¼”ç¤ºç«™åœ°å€`http://image-oss-demo.oldmoon.top`ï¼š

     ```yaml
     # æœåŠ¡ä¿¡æ¯é…ç½®
     info:
       server-url: http://localhost:80
     ```

   - **å»ºè®®ä¿®æ”¹çš„é…ç½®**ï¼Œå‚è€ƒä¸‹æ–¹æ³¨é‡Šè‡ªè¡Œä¿®æ”¹å³å¯ï¼š

     ```yaml
     # ä¸ªäººè®¤è¯ç ï¼ˆæˆæƒç ï¼‰é…ç½®
     user:
       # ä¸ªäººæˆæƒç é›†åˆï¼Œå¯ä»¥å¤šä¸ª
       key-map:
         # testå¯ä»¥ç†è§£ä¸ºç”¨æˆ·åï¼ŒtestKeyæ˜¯ç”¨æˆ·testçš„ä¸ªäººæˆæƒç 
         testKey: test
         # test2å¯ä»¥ç†è§£ä¸ºç”¨æˆ·åï¼ŒtestKey2æ˜¯ç”¨æˆ·test2çš„ä¸ªäººæˆæƒç 
         testKey2: test2
     ```

     

3. åœ¨`docker-compose.yml`å’Œ`application.yml`çš„æ‰€åœ¨æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼Œä¼šè‡ªåŠ¨æ‹‰å–`image-oss`çš„æœ€æ–°é•œåƒå¹¶å¯åŠ¨ï¼š

   ```sh
   docker-compose up -d
   ```

### ç«¯å£å ç”¨

é€šè¿‡æœ¬é¡¹ç›®æä¾›çš„`docker-compose.yml`éƒ¨ç½²ï¼Œè‹¥ä¸åšä»»ä½•ä¿®æ”¹ï¼Œå°†å ç”¨å®¿ä¸»æœºï¼ˆæœåŠ¡å™¨ï¼‰ä¸€ä¸ªç«¯å£ï¼š`11080`ã€‚

### æ³¨æ„äº‹é¡¹

1. ä¸ªäººæˆæƒç æ˜¯å¿…é¡»çš„ï¼Œåœ¨å¿«é€Ÿå¼€å§‹ä¸­**å»ºè®®ä¿®æ”¹çš„é…ç½®**å°±æ˜¯ç”¨äºç»´æŠ¤ä¸ªäººæˆæƒç çš„ï¼›
2. ç”¨æˆ·åä¸æ¢ï¼Œæˆæƒç æ›´æ¢ï¼Œä»ç„¶ä¼šè®¤ä¸ºæ˜¯åŒä¸€ä¸ªç”¨æˆ·ï¼ˆå›¾ç‰‡ä¿å­˜åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹ï¼‰ï¼›
3. **å‰ç«¯é¡µé¢ä¸­ï¼Œä¸ªäººæˆæƒç å¿…é¡»å¡«å†™æ­£ç¡®çš„ï¼Œå¦åˆ™å‡ ä¹æ‰€æœ‰åŠŸèƒ½éƒ½æ— æ³•ä½¿ç”¨**ï¼›
4. åœ¨å‰ç«¯è¾“å…¥ä¸ªäººæˆæƒç å¹¶æˆåŠŸä¸Šä¼ ä¸€æ¬¡å›¾ç‰‡åï¼Œ*æˆæƒç ä¼šä¿å­˜è‡³æµè§ˆå™¨ç¼“å­˜ä¸­*ï¼Œåœ¨ä¸æ¸…é™¤ç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œä¸‹æ¬¡æ‰“å¼€é¡µé¢å°†è‡ªåŠ¨å¡«å……æˆæƒç ï¼Œæ°´å°åŒç†ã€‚
5. æ°´å°ç›®å‰ä»…æ”¯æŒ`jpg,jpeg,png`ä¸‰ç§æ–‡ä»¶ç±»å‹ï¼Œå…¶ä»–ç±»å‹å›¾ç‰‡ä¸Šä¼ æ—¶ï¼Œè¯·æ¸…ç©ºé¡µé¢**`è¯·è¾“å…¥æ°´å°å†…å®¹`**çš„è¾“å…¥æ¡†ï¼Œå¦åˆ™å°†å¯¼è‡´ä¸Šä¼ å¤±è´¥ã€‚
6. å¦‚æœæ˜¯äº’è”ç½‘å›¾åºŠï¼Œå»ºè®®æœåŠ¡å™¨å¸¦å®½åœ¨10Mä»¥ä¸Šï¼Œå¦åˆ™ä¸Šä¼ æ–‡ä»¶è¾ƒå¤§å®¹æ˜“å¼•èµ·è¶…æ—¶å¼‚å¸¸ã€‚
7. ç›®å‰æœåŠ¡æ”¯æŒé»˜è®¤æ”¯æŒ30Mçš„æ–‡ä»¶ä¸Šä¼ ï¼Œå¦‚æœ‰éœ€æ±‚å¯æŒ‰éœ€ä¿®æ”¹ï¼Œæœ€å¤§å¯æ”¹ä¸º50Mã€‚
7. æ°´å°è¿˜ä¸æ”¯æŒä¸­æ–‡ã€‚ã€‚ã€‚ç›¸ä¿¡æˆ‘ä¼šå°½å¿«æ”¯æŒçš„ã€‚ã€‚ã€‚

## å¸¸è§æŠ¥é”™

- `No Permission!`ï¼šæ— æƒé™ï¼Œè¯·æ£€æŸ¥ä¸ªäººæˆæƒç æ˜¯å¦æ­£ç¡®ã€‚
- `Uploaded file type is not supported!`ï¼šä¸æ”¯æŒä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ã€‚
- `The file type with watermark is not supported!`ï¼šä¸æ”¯æŒåŠ æ°´å°çš„æ–‡ä»¶ç±»å‹ã€‚
- `Unknown Exception!`ï¼šåœ¨æ–‡ä»¶å¤„ç†æ—¶å‡ºç°äº†é¢„æœŸå¤–çš„å¼‚å¸¸ï¼Œå‡ºç°è¿™ä¸ªé”™è¯¯æ—¶ï¼Œå»ºè®®æäº¤`ISSUE`ã€‚
- `System Error!`ï¼šç³»ç»Ÿé”™è¯¯ï¼Œå¸¸è§åŸå› å¯èƒ½æ˜¯ï¼šæœåŠ¡ç«¯æœªçŸ¥å¼‚å¸¸ã€ç½‘ç»œè¿æ¥å¼‚å¸¸ã€‚

**å¦‚æœä½ æœ‰ä»»ä½•å…¶ä»–é—®é¢˜ï¼Œéƒ½å¯ä»¥æäº¤ISSUEï¼**

## æŠ€æœ¯ç‚¹

- Java - springboot
- html + css + javascript
- nginx
- docker

## å®ç°åŸç†


### åç«¯

åç«¯ä½¿ç”¨springbootå¼€å‘ä¸€ä¸ªå¾®æœåŠ¡ï¼Œæä¾›æ¥å£ï¼Œä»¥æ”¯æŒå›¾ç‰‡ä¸Šä¼ å’Œå¯¼å‡ºç­‰ä¸»è¦åŠŸèƒ½ã€‚

### å‰ç«¯

> å‰ç«¯æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„`html`æ–‡ä»¶ï¼ŒåˆæœŸæœåŠ¡ç«¯åªæä¾›åç«¯æ¥å£æ”¯æŒï¼Œè§‰å¾—å¤šç»ˆç«¯ç”¨èµ·æ¥æŒºéº»çƒ¦ï¼Œæ‰€ä»¥ç°åœ¨å·²å°†å‰ç«¯ä¹Ÿèåˆåˆ°dockeré•œåƒä¸­ã€‚

ç°åœ¨ä½¿ç”¨æœ€æ–°ç‰ˆdockeré•œåƒéƒ¨ç½²ï¼Œç›´æ¥è®¿é—®æœåŠ¡å³å¯è·å¾—å‰ç«¯é¡µé¢ã€‚

### Nginx

Nginxåœ¨é¡¹ç›®ä¸­èµ·åˆ°å¾ˆé‡è¦çš„ä½œç”¨ï¼Œä¸»è¦æœ‰ï¼š

1. å‰ç«¯é¡µé¢è®¿é—®ï¼›
2. å›¾ç‰‡èµ„æºæŸ¥çœ‹ï¼ˆå›¾ç‰‡ã€å›¾åº“ï¼‰ï¼›
3. åç«¯æœåŠ¡è½¬å‘ã€‚

ä½†å¤§å®¶å¯ä»¥æ”¾å¿ƒï¼Œå¦‚æœä½ ä¸æ‡‚Nginxä¹Ÿå¯ä»¥è½»æ¾ä½¿ç”¨ï¼ŒNginxç›¸å…³é…ç½®å·²ç»é›†æˆåˆ°Dockerå®¹å™¨ä¸­ï¼Œä¸åšä»»ä½•ä¿®æ”¹å³å¯ç›´æ¥ä½¿ç”¨ã€‚

## æ¼”ç¤ºç«™

æ¼”ç¤ºç«™ä¸€èˆ¬æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ï¼š[http://image-oss-demo.oldmoon.top/](http://image-oss-demo.oldmoon.top/)

ä¸ªäººæˆæƒç å¯ä»¥ä½¿ç”¨`testKey`å’Œ`testKey2`è¿›è¡Œæµ‹è¯•ã€‚

**ä¸è¦çæå“¦ï¼Œæ¼”ç¤ºç«™æœåŠ¡å™¨å¾ˆè„†å¼±ï¼Œç£ç›˜ç©ºé—´å¾ˆå°ï¼Œä¹Ÿæ²¡å•¥é‡è¦çš„ä¸œè¥¿ï¼Œå´©äº†å°±é‡è£…ç³»ç»Ÿã€‚ã€‚ã€‚ğŸ˜‰**

### ä½¿ç”¨æ•ˆæœç¤ºä¾‹

> ç¤ºä¾‹é¡µé¢å¯èƒ½ä¸æœ€æ–°ç‰ˆé¡µé¢æœ‰æ‰€å·®å¼‚ï¼Œä½†åŠŸèƒ½å¤§è‡´ç›¸åŒã€‚

![images-oss](./images-oss.gif)

### æœ€æ–°åŠŸèƒ½ï¼šå¢åŠ å›¾åº“åœ¨çº¿æŸ¥çœ‹å›¾ç‰‡

![images-oss](./images/1693822495308.jpg)
